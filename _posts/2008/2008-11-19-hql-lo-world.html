---
layout: post
title: HQL-lo World
date: '2008-11-19T23:58:00.002Z'
author: Dylan Beattie
tags:
- castle
- dotnet
- altnet
- c#
modified_time: '2017-03-18T15:03:45.154Z'
thumbnail: http://lh5.ggpht.com/_LV_l8kYLOwo/SSSoP0dNz8I/AAAAAAAAAHg/DghJ3Mu8pZ4/s72-c/image_thumb%5B6%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-7295454224203070190.post-3350003841404412024
blogger_orig_url: http://www.dylanbeattie.net/2008/11/hql-lo-world.html
redirect_from: "/2008/11/hql-lo-world.html"

---

<p>I've been playing with Castle ActiveRecord for a project I'm working on, and hit a brick wall earlier tonight that left me completely stuck for a couple of hours... and turned out to be incredibly simple and obvious. Turns out I'd refactored one of my business objects - from Page to CmsPage - and hadn't noticed that in one particular place in the code, I was doing this:</p>  <pre class="code"><span style="background: black; color:#40c4ff;">var </span><span style="background: black; color:#eddac0;">rootPages </span><span style="background: black; color:silver;">= </span><span style="background: black; color:#40c4ff;">new </span><span style="background: black; color:cyan;">SimpleQuery</span><span style="background: black; color:silver;">&lt;</span><span style="background: black; color:cyan;">CmsPage</span><span style="background: black; color:silver;">&gt;</span><span style="background: black; color:#e0e0e0;">(</span><span style="background: black; color:#cc80d2;">@"from Page p where p.Parent is null"</span><span style="background: black; color:#e0e0e0;">);
</span><span style="background: black; color:#40c4ff;">return </span><span style="background: black; color:#e0e0e0;">(</span><span style="background: black; color:#eddac0;">rootPages</span><span style="background: black; color:silver;">.</span><span style="background: black; color:#eddac0;">Execute</span><span style="background: black; color:#e0e0e0;">());</span></pre><p>The Execute() call there was throwing an ActiveRecordException that just said <strong>{"Could not perform ExecuteQuery for CmsPage"} - </strong>no InnerException, nothing showing up in SQL Profiler, nothing except a bunch of query strings that all looked fine to me:</p><p><a href="http://lh6.ggpht.com/_LV_l8kYLOwo/SSSoPYXwOYI/AAAAAAAAAHc/rlc-XhkmYkg/s1600-h/image%5B10%5D.png"><img style="border-right: 0px; border-top: 0px; margin: 10px 0px; border-left: 0px; border-bottom: 0px" height="416" alt="image" src="http://lh5.ggpht.com/_LV_l8kYLOwo/SSSoP0dNz8I/AAAAAAAAAHg/DghJ3Mu8pZ4/image_thumb%5B6%5D.png?imgmax=800" width="563" border="0" /></a> </p><p>Even <a href="http://using.castleproject.org/display/AR/Troubleshooting">enabling ActiveRecord logging</a> (which was wonderfully easy, by the way) didn't help - I couldn't see anything obviously amiss in the NHibernate logs.</p><p>Turns out I'd not yet got my head around a fundamental concept of object-relational mapping, namely that <strong>you are querying your</strong> <strong>objects</strong>, <strong>not your database. </strong>The string literal in the SimpleQuery definition that looks a bit like LINQ is HQL - Hibernate Query Language. I'd used the [ActiveRecord(Table="Page")] attribute to map the renamed class to the underlying DB table, which is still called Page, and it just completely didn't occur to me that the HQL query needs to be changed to reflect the new class name. Change that query to</p><pre class="code"><span style="background: black; color:#40c4ff;">var </span><span style="background: black; color:#eddac0;">rootPages </span><span style="background: black; color:silver;">= </span><span style="background: black; color:#40c4ff;">new </span><span style="background: black; color:cyan;">SimpleQuery</span><span style="background: black; color:silver;">&lt;</span><span style="background: black; color:cyan;">CmsPage</span><span style="background: black; color:silver;">&gt;</span><span style="background: black; color:#e0e0e0;">(</span><span style="background: black; color:#cc80d2;">@"from CmsPage p where p.Parent is null"</span><span style="background: black; color:#e0e0e0;">);</span></pre><p>and it works as intended. I fear this ORM stuff is going to take some getting used to...</p>