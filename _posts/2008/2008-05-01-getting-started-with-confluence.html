---
layout: post
title: Getting Started with Confluence
date: '2008-05-01T19:01:00.001+01:00'
author: Dylan Beattie
tags:
- wiki
- altnet
- confluence
modified_time: '2008-05-04T11:25:26.608+01:00'
blogger_id: tag:blogger.com,1999:blog-7295454224203070190.post-9072803627947916108
blogger_orig_url: http://www.dylanbeattie.net/2008/05/getting-started-with-confluence.html
redirect_from: "/2008/05/getting-started-with-confluence.html"

---

<p>In principle, I think wikis are great. I've worked on too many projects that have ended up with fifteen different copies of the &quot;definitive&quot; functional spec - all called something like <strong>Copy (2) of Rhubarb - Functional Spec - FINAL (3).doc</strong> - and no-one's really sure what's going on any more. The idea of a centralised documentation repository that everyone can read and anyone can edit, with a full history of who changed what, is appealing to say the least.</p>  <p>In practise - software specs are weird, awkward documents. Some concepts and ideas are best described as English prose. Some things are best described using screenshots, sketches, flow charts, sequence diagrams, class diagrams. Some things are best included by just pasting the code - 'cos you've already written it, and at the end of the day C# is just a really, really accurate description of an algorithmic solution to a particular problem.</p>  <p>I've played with <a href="http://www.mediawiki.org/">MediaWiki</a>, but found the installation process a bit daunting - we're a Microsoft shop; we have Windows, SQL Server and the like already up and running, and no real LAMP expertise to speak of...</p>  <p>I've set up <a href="http://sharpforge.org/">Sharpforge</a>, I've used the wiki engine built in to <a href="http://www.fogcreek.com/FogBUGZ/">FogBugz</a>. I've recently been playing with <a href="http://www.high-beyond.com/">PerspectiveWiki</a> (and I have to say, the v3 alpha is very, very nice indeed - but covered in warnings about how it's early alpha and you shouldn't use it for real). </p>  <p>One notable platform I haven't played with is Sharepoint... call me cynical, but when it's a Microsoft business platform that you can attend a five-day training course on, it's probably not quick &amp; easy. We're not that big a team, we're all in one building, there's relatively little collaborative authoring going on, and Sharepoint just feels like total overkill for what we need. </p>  <p>So... this morning, I googled &quot;project documentation wiki&quot; or some such phrase, and stumbled across a commercial wiki engine called <a href="http://www.atlassian.com/software/confluence/">Confluence</a>. <a href="http://blog.mikecoon.net/">Mike Coon</a> wrote a post a while back called &quot;<a href="http://blog.mikecoon.net/2007/11/04/include-everything-your-application-needs.aspx">It's the Installation, Stupid</a>&quot; - basically saying that nobody wants to install and configure a whole application stack just to try out a new package. He's absolutely right. Confluence uses J2EE, Tomcat, Apache and a whole raft of stuff I really don't want to install - but I didn't have to. I just ran setup.exe. Despite the fact it's based on J2EE, a platform I've never even touched - I had an evaluation up and running on one of our dev servers within half an hour. So far, I'm very impressed with it. The WYSIWYG editing is slick and intuitive, the admin and configuration is excellent, and if all goes well I'll be putting my money where my mouth is before the month is up :)</p>  <p>A couple of hours later, and it was up and running against our existing MS SQL Server database, authenticating via LDAP against our Active Directory server, and generally making the world a better place. One of these days I really have to get my head around LDAP a little better... when it works, it's absolutely wonderful (&quot;no, no new password, just log in with your normal one&quot;) but my LDAP filters are too close to <a href="http://en.wikipedia.org/wiki/Cargo_cult_programming">cargo-cult programming</a> for comfort right now.</p>  <p>One major gotcha that was almost a showstopper until I found a way around it was getting Confluence to run on the default port 80 on the same server as our existing IIS intranet site, so here's what I did - and so far, it's working.</p>  <h3>Confluence coexisting with IIS on a single server</h3>  <p>Microsoft IIS, by default, grabs port 80 of every IP address on your server - and there's no way to switch this off using built-in Windows admin capabilities. This means if you want another web server running on the same box, you need to do a bit of tweaking to both IIS and the other server to make them coexist happily.</p>  <p>Confluence installs by default on port 8080, but for various reasons (mainly being I just don't like it), I wanted to get it running on port 80 - alongside the existing IIS sites.</p>  <p>There's extensive docs at the Confluence site about installing an ISAPI redirect so you can have <a href="http://www.mysite.com">www.mysite.com</a> hosted by IIS and <a href="http://www.mysite.com/wiki">www.mysite.com/wiki</a> invisibly proxy all requests to a JIRA or Confluence server - but that's not really what I was after. </p>  <p>First off, I bound a second IP address to the adapter of the server via Windows' TCP/IP controls - so my server was now running on 192.168.0.78 and 192.168.0.79</p>  <p>Next thing to do was to set up a DNS record (you could also spoof this using your /etc/hosts file) on our local server, so that <a href="http://wiki/">http://wiki/</a> resolved to 192.168.0.79 - all our existing intranet addresses still resolve to the previous 192.168.0.78 address</p>  <p>Now for the fun part, which is lovingly documented in <a href="http://support.microsoft.com/kb/813368">Microsoft Knowledge Base Article 813368</a>. Basically, you need to download the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=96a35011-fd83-419d-939b-9a772ea2df90&amp;displaylang=en">Windows Server 2003 Support Tools</a>, and use the included httpcfg.exe to modify the IIS metabase so that IIS will only listen on specified IP addresses. This done, it meant that IIS was still running fine on 192.168.0.78, and 192.168.0.79:80 was still available.</p>  <p>Next step was to modify the server.xml file that's shipped with Confluence. I have to admit this part was pretty much guesswork, but it made sense and it seems to have worked, so use it at your own risk. </p>  <p>By default, this file is installed at C:\Program Files\Atlassian Confluence\Application\conf\server.xml, and the clue is the &lt;Connector /&gt; section which refers to port 8080. By default, Confluence installs at <a href="http://localhost:8080/">http://localhost:8080/</a>, so on a hunch I tried switching port=&quot;8080&quot; to port=&quot;80&quot; in this node, restarting Confluence, and as if by magic, everything started working.</p>  <pre class="code"><span style="color: blue">&lt;</span><span style="color: #a31515">Server </span><span style="color: red">port</span><span style="color: blue">=</span>&quot;<span style="color: blue">8005</span>&quot; <span style="color: red">shutdown</span><span style="color: blue">=</span>&quot;<span style="color: blue">SHUTDOWN</span>&quot; <span style="color: red">debug</span><span style="color: blue">=</span>&quot;<span style="color: blue">0</span>&quot;<span style="color: blue">&gt;<br />    &lt;</span><span style="color: #a31515">Service </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">Tomcat-Standalone</span>&quot;<span style="color: blue">&gt;<br /></span><span style="color: blue">        &lt;</span><span style="color: #a31515">Connector </span><span style="color: red">className</span><span style="color: blue">=</span>&quot;<span style="color: blue">org.apache.coyote.tomcat4.CoyoteConnector</span>&quot; <br />           <span style="color: red">port</span><span style="color: blue">=</span>&quot;<span style="color: blue">80</span>&quot; <br />           <span style="color: red">minProcessors</span><span style="color: blue">=</span>&quot;<span style="color: blue">5</span>&quot;<br />           <span style="color: red">maxProcessors</span><span style="color: blue">=</span>&quot;<span style="color: blue">75</span>&quot;<br />           <span style="color: red">enableLookups</span><span style="color: blue">=</span>&quot;<span style="color: blue">false</span>&quot; <br />           <span style="color: red">redirectPort</span><span style="color: blue">=</span>&quot;<span style="color: blue">8444</span>&quot; <br />           <span style="color: red">acceptCount</span><span style="color: blue">=</span>&quot;<span style="color: blue">10</span>&quot; <br />           <span style="color: red">debug</span><span style="color: blue">=</span>&quot;<span style="color: blue">0</span>&quot; <br />           <span style="color: red">connectionTimeout</span><span style="color: blue">=</span>&quot;<span style="color: blue">20000</span>&quot;<br />           <span style="color: red">useURIValidationHack</span><span style="color: blue">=</span>&quot;<span style="color: blue">false</span>&quot; <br />           <span style="color: red">URIEncoding</span><span style="color: blue">=</span>&quot;<span style="color: blue">UTF-8</span>&quot;<br />        <span style="color: blue">/&gt;</span></pre>  