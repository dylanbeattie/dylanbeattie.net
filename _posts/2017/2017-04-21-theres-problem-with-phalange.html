---
layout: post
title: There’s a problem with the phalange!
date: '2017-04-21T16:55:00.001+01:00'
author: Dylan Beattie
tags:
- patterns
- c#
- coding
modified_time: '2017-04-21T16:57:22.958+01:00'
thumbnail: https://i.ytimg.com/vi/DrwVB4vMx-Q/default.jpg
blogger_id: tag:blogger.com,1999:blog-7295454224203070190.post-5329509829218814530
blogger_orig_url: http://www.dylanbeattie.net/2017/04/theres-problem-with-phalange.html
---

<iframe height="315" src="https://www.youtube.com/embed/DrwVB4vMx-Q" frameborder="0" width="560" allowfullscreen></iframe> <p align="left">Yesterday I was throwing together a quick Entity Framework prototype to inspect and wrangle some data held in one of our legacy databases. I’m using the Entity Framework “Code first from Database” approach, where you use the tooling to generate your initial model for you but thereafter you modify it by hand. One of the tables I’m working with here is called <strong>LookupRanges</strong>, so when I generated a bunch of entities and <strong>DbSet&lt;&gt;</strong> mappings, I was a bit surprised when I ended up with a class called <strong>LookupRanx</strong> in my new model.</p> <p align="left">It took a minute or two to ascertain that yes, Entity Framework had mapped my <strong>LookupRanges</strong> (plural) table name onto a class called <strong>LookupRanx</strong>. But where on earth did that ‘<strong>Ranx</strong>’ come from? My hunch here is that somebody who worked on this pluralization code remembered that the English word <em>phalanx</em> has the plural form <em>phalanges </em>– and so implemented a rule that says ‘any word ending in <em>–anges</em> should be singularizaed to <em>–anx</em>. Out of curiousity, I dug out my huge ASCII file of English words, found all the words ending in *anges, and hacked up a quick SQL script to create tables named for all these words so I could run them through EF and see what class names were generated. </p> <p align="left">Well, it gets ‘changes’ and ‘phalanges’ right – and gets literally every other case wrong. </p> <p align="left"><a href="https://lh3.googleusercontent.com/-q3BkKT_2oko/WPorXCNsMEI/AAAAAAAAEYg/dmGR8xxEEaE/s1600-h/image%25255B3%25255D.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://lh3.googleusercontent.com/-_5rE3biF9hI/WPorXlGnKOI/AAAAAAAAEYk/Y3Sw9WUB6eQ/image_thumb%25255B1%25255D.png?imgmax=800" width="478" height="217"></a></p> <p align="left">Now this, to me, is an outstanding example of one of the biggest problems in software development… smart people like working on things that are <em>interesting</em>, and will frequently spend time doing something that’s interesting instead of something that’s important.</p> <p align="left">Writing a library that can singularize and pluralize English words is fascinating. It’s a never-ending problem with dozens of rules and hundreds of edge cases, and you learn a lot of weird and cool esoteric facts about language and etymology whilst you’re doing it. But in this instance, something started out as a good idea (“hey – wouldn’t it be cool if the model generator would convert plural table names to singular class names?”), and got bogged down in edge cases (“is the plural of ‘tableau’ really ‘tableaux’?”) and – in this instance – ended up with a bizarre bug because one of those so-called edge cases actually ended up breaking the default – and entirely correct – behaviour.</p> <p align="left">First, <em>phalanges</em> is extremely unlikely to ever show up as the name of a table in an Entity Framework database model. I can think of dozens of real-world scenarios where you’d end up with a table name ending with –Ranges, –Exchanges or –Interchanges, but I’m honestly struggling to think of any remotely likely scenario where you have a Phalanges table in a SQL Server database. This is the kind of thing where the ticket or the user story probably just says ‘implement pluralization’, and then there’s no sub-prioritization or further analysis about just how much pluralization needs to be implemented. Second – it’s kind of a stupid edge case. We’re not trying to win points on University Challenge here, we’re building software. In contemporary English, <strong><a href="https://www.merriam-webster.com/dictionary/phalange">phalange</a></strong> is an acceptable singular form, and <strong><a href="https://www.merriam-webster.com/dictionary/phalanxes">phalanxes</a> </strong>is an acceptable plural form. There’s no reason at all why they needed to implement support for this particular edge case. And third: if you <em>really </em>found yourself in a scenario where you had to map the Phalanges table to the Phalanx class, you can just rename it. It’s easy. Visual Studio has first-class support for this kind of refactoring.</p> <p align="left">And, as if that wasn’t confusing enough, there’s actually source code for an <a href="https://github.com/Microsoft/referencesource/blob/90b323fe52bec428fe4bd5f007e9ead6b265d553/System.Data.Entity.Design/System/Data/Entity/Design/PluralizationService/EnglishPluralizationService.cs#L48">EnglishPluralizationService.cs</a> on Microsoft’s GitHub repository. Somebody obviously had a lot of fun building this, tracking down all those bizarre little edge cases like seraph/seraphim, hippopotamus/hippopotami – but according to <strong>this</strong> implementation, the plural of phalanx is…&nbsp; go on. Go and <a href="https://github.com/Microsoft/referencesource/blob/90b323fe52bec428fe4bd5f007e9ead6b265d553/System.Data.Entity.Design/System/Data/Entity/Design/PluralizationService/EnglishPluralizationService.cs#L257">take a look</a>.</p> <p align="left">Now, though, I’m going to eat an oranx and check my email. Using Microsoft Exchanx, of course.</p>