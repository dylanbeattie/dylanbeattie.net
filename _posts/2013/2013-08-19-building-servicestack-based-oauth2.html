---
layout: post
title: Building a ServiceStack-based OAuth2 resource server using DotNetOpenAuth
date: '2013-08-19T22:07:00.001+01:00'
author: Dylan Beattie
tags: 
modified_time: '2013-08-22T18:00:17.876+01:00'
blogger_id: tag:blogger.com,1999:blog-7295454224203070190.post-6938730804985966631
blogger_orig_url: http://www.dylanbeattie.net/2013/08/building-servicestack-based-oauth2.html
---

<p>Last week, I asked on StackOverflow if <a href="http://stackoverflow.com/questions/18257753">anyone had used DotNetOpenAuth to secure a ServiceStack API using OAuth2</a>. Well, it would appear not… so alongside a week of band rehearsals and a big old party last weekend, I’ve put a proof of concept up onGithub that demonstrates how to use ServiceStack and DotNetOpenAuth together to create a REST API that’s secured using OAuth2. The app I’m working on is aimed specifically at existing customers, who will already have a login account on our site, so I don’t need to use OpenID at all. In fact, I spent a good few days puzzling over this before I realised my mistake. After digging through the various specs and innumerable blog posts, I decided to use the <a href="http://tools.ietf.org/html/rfc6749">OAuth2 authorization framework</a> – specifically, a feature of that framework called the <a href="http://tools.ietf.org/html/rfc6749#section-4.3">resource owner password credentials grant</a></p>  <p>The DotNetOpenAuth project includes a couple of great OAuth2 samples, including an authorization server (the bit that does the customer login), but they’re built primarily around ASP.NET MVC or WCF. I’ve worked with both of these in the past, but recently I’ve switched to using the <a href="http://www.servicestack.net/">ServiceStack</a> library to build ReST APIs, and I absolutely love it. It’s easy to use, easy to extend, and wonderfully lightweight, so I wanted to use ServiceStack to build the data API that our app is going to use. I assumed it wouldn’t be too hard to build our own authorisation server, and then use a standard protocol like OAuth to control access to the resources exposed by this server.</p>  <p>There’s a working prototype / proof of concept up on GitHub now, at <a href="https://github.com/dylanbeattie/OAuthStack">https://github.com/dylanbeattie/OAuthStack</a> – complete with commentary on how the various integration points worked. OAuth2 is actually conceptually quite simple, but getting the two libraries to work together proved a little fiddly; both ServiceStack and OpenAuthDotNet use their own abstractions over the ASP.NET request/response objects, making me really wish Microsoft hadn’t made the .NET HTTP framework quite so inflexible back in the day… but after a week or so of tinkering, testing, poring over RFCs and bouncing around in the Visual Studio debugger, I’ve got something that seems pretty lightweight, doesn’t reinvent the wheel, and seems to satisfy the requirements. </p>  <p>Suffice to say that if DotNetOpenAuth and ServiceStack weren’t open source this kind of integration would have been practically impossible, so I want to say a huge thank you to the authors and maintainers of both of those projects. Thanks, guys. You rock :)</p>  