---
layout: post
title: How to host Git in the same Apache server that comes with CollabNet Subversion
date: '2011-02-07T23:28:00.001Z'
author: Dylan Beattie
tags: 
modified_time: '2011-02-07T23:28:13.738Z'
thumbnail: http://lh5.ggpht.com/_de7B8BtZZIw/TVCADJNcToI/AAAAAAAAAFY/3Gmsu7VpLFU/s72-c/IMG_6726_thumb%5B4%5D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-7295454224203070190.post-8173342425657493215
blogger_orig_url: http://www.dylanbeattie.net/2011/02/how-to-host-git-in-same-apache-server.html
redirect_from: "/2011/02/how-to-host-git-in-same-apache-server.html"

---

<p align="justify"><a href="http://lh4.ggpht.com/_de7B8BtZZIw/TVCACwdo4_I/AAAAAAAAAFU/MybNY-C16R0/s1600-h/IMG_6726%5B7%5D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px 0px 20px 20px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top: 0px; border-right: 0px; padding-top: 0px" title="This is the moon rising over the Costa Smeralda, Sardinia. It has nothing to do with revision control." border="0" alt="This is the moon rising over the Costa Smeralda, Sardinia. It has nothing to do with revision control." align="right" src="http://lh5.ggpht.com/_de7B8BtZZIw/TVCADJNcToI/AAAAAAAAAFY/3Gmsu7VpLFU/IMG_6726_thumb%5B4%5D.jpg?imgmax=800" width="320" height="240" /></a><a href="http://www.collab.net/products/subversion/whatsnew.html">CollabNet Subversion Edge</a> is a great Subversion distro that includes Apache 2.2 and the ViewVC web-based repo browser, and makes it really, really easy to get up and running with Subversion and WebDAV. I’m setting up a project server to host something we’re working on, and it’s been generally decided that whilst Subversion is all very well for keeping Word documents in, we’d quite like something a touch more… <em>distributed</em> for the actual source code repo. And when <a href="http://jagregory.com/">James Gregory</a> mentioned on Twitter that git would mean “<a href="http://twitter.com/#!/jagregory/status/34710468748779520">no more tree conflicts</a> ”, I may have actually started salivating… ahem. </p>  <p align="justify">Anyway, yes. Apparently Git is quite good. </p>  <p align="justify"><a href="http://www.jeremyskinner.co.uk/2010/07/31/hosting-a-git-server-under-apache-on-windows/">Jeremy Skinner has some fantastic notes</a> on how to get git up and running with Apache 2.2. on a Windows server – I followed these pretty much to the letter to get my first incarnation up and running, but had to comment out a bunch of the Collabnet/Subversion settings in the Apache config files to get the Git server running properly. A bit of tinkering, though, and I’m pretty much there. What makes this interesting is that CollabNet includes a web-based admin console, which makes configuring the built-in modules very straightforward, but it does mean several of the config files have this rather ominous warning at the top:</p>  <blockquote>   <p align="justify"><strong>#        <br /># DO NOT EDIT THIS FILE IT WILL BE REGENERATED AUTOMATICALLY BY COLLABNET SUBVERSION&#160; <br />#</strong></p> </blockquote>  <p align="justify">so – any changes we make in there will be just peachy until someone touches the web interface, at which point BOOM! they’ll spontaneously stop working. So whatever we’re going to do, we need to do it without touching any of those files. I wasn’t sure at first whether this would be possible, but it seems to be up and running now and hanging together quite nicely. </p>  <p align="justify">Fire up the Apache httpd.conf file in <a href="http://code.kliu.org/misc/notepad2/">your favourite editor</a> – by default it’ll be in C:\Program Files\Subversion\data\conf\ – and add the following lines at the end:</p>  <blockquote>   <p align="justify"><em><font color="#a5a5a5"># Configure Apache to listen for named virtual hosts on port 80         <br /></font></em><strong>NameVirtualHost *:80</strong></p>    <p align="justify"><em><font color="#a5a5a5"># Include the configuration file for our git http hosting</font>        <br /></em><strong>Include &quot;C:\Program Files\Subversion\data\conf\git_httpd.conf&quot;</strong></p> </blockquote>  <p align="justify">Now create a new document called – yep - <strong>C:\Program Files\Subversion\data\conf\git_httpd.conf</strong> – and make it look something like this:</p>  <blockquote>   <p align="justify"><font color="#a5a5a5"># HTTP settings for using Apache with MSysGit on Windows       <br /># Based on Jeremy Skinner's notes at </font><a href="http://www.jeremyskinner.co.uk/2010/07/31/hosting-a-git-server-under-apache-on-windows/"><font color="#a5a5a5">http://www.jeremyskinner.co.uk/2010/07/31/hosting-a-git-server-under-apache-on-windows/</font></a></p>    <p align="justify">&lt;VirtualHost *:80&gt;</p>    <p align="justify"><font color="#a5a5a5">&#160;&#160;&#160; # Set this to the root folder containing your Git repositories.       <br /></font>&#160;&#160;&#160; SetEnv GIT_PROJECT_ROOT D:/Git/      <br />&#160;&#160;&#160; <br /><font color="#a5a5a5">&#160;&#160;&#160; # Set this to export all projects by default (by default,        <br />&#160;&#160;&#160; # git will only publish those repositories that contain a        <br />&#160;&#160;&#160; # file named “git-daemon-export-ok”</font>      <br />&#160;&#160;&#160; SetEnv GIT_HTTP_EXPORT_ALL      <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; <font color="#a5a5a5"># Route specific URLS matching this regular expression to the git http server.       <br /></font>&#160;&#160;&#160; ScriptAliasMatch &quot;(?x)^/git/(.*/(HEAD | info/refs | \      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; objects/(info/[^/]+ | [0-9a-f]{2}/[0-9a-f]{38} | pack/pack-[0-9a-f]{40}\.(pack|idx)) | \      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; git-(upload|receive)-pack))$&quot; \       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;C:/Program Files (x86)/git/libexec/git-core/git-http-backend.exe/$1&quot;      <br />&#160;&#160;&#160; <br /><font color="#a5a5a5">&#160;&#160;&#160; # The canonical DNS hostname that you want to use for your git server</font>      <br />&#160;&#160;&#160; ServerName my_git_server      <br />&#160;&#160;&#160;&#160; <br /><font color="#a5a5a5">&#160;&#160;&#160; # Any other DNS aliases that point to your git server</font>      <br />&#160;&#160;&#160; ServerAlias my_git_server my_git_server.mydomain.com my_git_server.my_intranet.local      <br />&#160;&#160;&#160;&#160; <br /><font color="#a5a5a5">&#160;&#160;&#160; # The root folder for non-GIT-hosted documents (e.g. phpgit or some other Web front end)</font>&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; DocumentRoot &quot;D:\gitserver\htdocs\&quot;      <br />&#160;&#160;&#160; &lt;Location /&gt;      <br /><font color="#a5a5a5">&#160;&#160;&#160;&#160;&#160;&#160;&#160; # This section is duplicated from the Collabnet SVN LDAP authentication        <br /></font>&#160;&#160;&#160;&#160;&#160;&#160;&#160; AuthType Basic      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; AuthName &quot;Spotlight GIT Repository&quot;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; AuthBasicProvider csvn-file-users ldap-users      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Require valid-user      <br />&#160;&#160;&#160; &lt;/Location&gt;      <br />&lt;/VirtualHost&gt;</p> </blockquote>  <p align="justify">Check your configuration by running httpd.exe from the command line, like so:</p>  <blockquote>   <p align="justify"><font color="#a5a5a5">C:\Program Files\Subversion\bin&gt;</font><strong>httpd.exe -f &quot;c:\program files\Subversion\data\conf\httpd.conf&quot; –t       <br /></strong>Syntax OK</p> </blockquote>  <p align="justify">and if all looks good, go into services.msc and restart the CollabNetSubversionServer service (which is actually Apache)</p>  <p align="justify">Finally, I followed Jeremy’s instructions to get GitPhp running, but then replaced it with a different project – also called GitPhp – from <a href="http://www.xiphux.com/programming/gitphp/">http://www.xiphux.com/programming/gitphp/</a>, which provides a full repository browser, revision history, etc.</p>  <p align="justify">All I had to do to get GitPHP running was to copy the gitphp.conf.php.example file to gitphp.conf.php, and then tweak the following settings:</p>  <blockquote>   <p align="justify"><font color="#a5a5a5">/* The root folder of my Git repositories */</font>      <br />$gitphp_conf['projectroot'] = 'D:\git';</p>    <p align="justify"><font color="#a5a5a5">/* On 64-bit Windows, C:\Program Files (x86) ends up as C:\Progra~2\ so these need to be configured manually */</font>      <br />$gitphp_conf['gitbin']&#160; = &quot;C:\Progra~2\Git\bin\git.exe&quot;;      <br />$gitphp_conf['diffbin']&#160; = &quot;C:\Progra~2\Git\bin\diff.exe&quot;;</p> </blockquote>  <p align="justify">Job done. I now have:</p>  <ul>   <li>     <div align="justify"><a href="http://my_svn_server/">http://my_svn_server/</a> returning regular HTML pages hosted by Apache</div>   </li>    <li>     <div align="justify"><a href="http://my_svn_server/svn/">http://my_svn_server/svn/</a> giving me a WebDAV browser view on my raw Subversion repositories</div>   </li>    <li>     <div align="justify"><a href="http://my_svn_server/viewvc/">http://my_svn_server/viewvc/</a> giving me ViewCV web-browsable revision historys and diffs on my Subversion repos</div>   </li>    <li>     <div align="justify"><a href="http://my_git_server/">http://my_git_server/</a> giving me GitPHP browsing of my Git repositories</div>   </li>    <li>     <div align="justify"><a href="http://my_git_server/git/">http://my_git_server/git/</a>&#160; exposing URLs for GIT cloning, fetching and pushing</div>   </li>    <li>     <div align="justify"><a href="http://my_iis_server/">http://my_iis_server/</a> is still running IIS 7 with .NET 4 and MVC 3</div>   </li> </ul>  <p align="justify">and that’s all on one box, with two IP addresses, with the svn and git servers sharing an instance of Apache on one address, the IIS server running on the other, and DNS records pointing svn and git at the first address and IIS at the second.</p>  