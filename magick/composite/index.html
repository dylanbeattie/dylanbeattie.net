<html>
<head>
<title>Image Composition using PerlMagick</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="home" type="text/html" href="/magick/">
<style type="text/css">
<!--
body {  font-family: Arial, Helvetica, sans-serif; font-size: x-small}
dt {  font-weight: bold}
pre {  font-size: small}
-->
</style>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<h1 align="center">Image Composition in PerlMagick with Alpha Transparency</h1>
<div align="center">Dylan Beattie &lt;imagemagick [at] dylanbeattie [dot] net&gt;<br>
  http://www.dylanbeattie.net/magick/composite/
  <br />
  <p>Part of <a href="http://www.dylanbeattie.net/magick/">Dylan's Collection of PerlMagick Stuff</a></p>
</div>
<hr>
<table width="75%" border="0" cellspacing="2" cellpadding="2" align="center">
  <tr>
    <td><b><font size="7"><img src="logo.jpg" width="300" height="200" align="middle"></font></b></td>
    <td><b><font size="7">+</font></b></td>
    <td><b><font size="7"><img src="background.jpg" width="300" height="200" align="middle"></font></b></td>
    <td><b><font size="7">=</font></b></td>
    <td><b><font size="7"><img src="output.jpg" width="300" height="200" align="middle"></font></b></td>
  </tr>
  <tr>
    <td>
      <div align="center"><b><font size="2">32-bit PNG with alpha channel</font></b></div>
    </td>
    <td>
      <div align="center"><font size="2"><font size="2"><b></b></font></font></div>
    </td>
    <td>
      <div align="center"><b><font size="2">background generated by PerlMagick</font></b></div>
    </td>
    <td>
      <div align="center"><font size="2"><font size="2"><b></b></font></font></div>
    </td>
    <td>
      <div align="center"><b><font size="2">Result</font></b></div>
    </td>
  </tr>
</table>
<hr>
<h2>Overview</h2>
<p>This page provides a simple example of using ImageMagick to overlay a transparent
  logo onto a generated background. I've frequently used this to create logo images
  for Web pages where the users can specify their own colour scheme; site colours
  are defined using a server-side script which produces a stylesheet based on
  their preferences, and variations on this script are used to re-generate logo
  images when they change their colour scheme. (Of course, if Microsoft would
  stop treating PNG support as some kind of joke, it wouldn't be necessary...
  but as long as the world+dog insist on using IE despite it's lack of alpha support,
  this script is a fairly effective work-around.)</p>
<h2>Ingredients</h2>
<p>A working install of PerlMagick - the examples here were generated using my
  <a href="http://www.dylanbeattie.net/magick/PerlMagick-5.4.0.zip">PPM build
  of PerlMagick 5.4.0</a> running on ActivePerl 618 under Windows 2000 Professional,
  but should work on any PerlMagick installation with PNG support. I believe PNG
  support is compiled in by default; I certainly didn't have to explicitly enable
  anything during the build process.</p>
<p>A 32-bit PNG file with alpha transparency. You can download logo.png (used
  in these examples) <a href="logo.png">here</a> - do a right-click and 'Save
  As...' otherwise your browser will probably just display the image. In my experience,
  PNGs generated by Macromedia Fireworks 4 work perfectly, and those exported
  by Corel PhotoPaint 9 don't work at all 'cos Corel's alpha support is broken.
  You might need to experiment. I'd be interested to hear from anyone trying this
  technique using PNGs from PhotoShop or the GIMP.</p>
<h2>Method</h2>
<p>logo.png starts out looking something like the left-hand image above - depending
  how your editor depicts transparency. What the script does is to generate a
  background, read this image, compose it over the background (preserving the
  transparency) and write the results as a JPG.</p>
<h2>The Script</h2>
<pre>#!/bin/perl
#
# Image composition with alpha transparency demo.
# logo.png (32-bit PNG with alpha channel) is required.
#
# http://www.dylanbeattie.net/magick/composite/</pre>
<pre>use Image::Magick;</pre>
<pre># Create background image - a 300x200 white-to-black gradient</pre>
<pre>$background=Image::Magick-&gt;new;
$logo = Image::Magick-&gt;new;
$background-&gt;Set(size=&gt;'300x200');
$background-&gt;Read(&quot;gradient:white-black&quot;);</pre>
<pre># Read the transparent logo from the PNG file
$logo-&gt;Read(&quot;png:logo.png&quot;);</pre>
<pre># Call the Composite method of the background image, with the logo image as an argument.
$background-&gt;Composite(image=&gt;$logo,compose=&gt;'over');
$background-&gt;Set(quality=&gt;100);
$background-&gt;Write(&quot;jpg:output.jpg&quot;);

# Clean up
undef $background;
undef $logo;</pre>
<h2>Problems?</h2>
<dl>
<dt>The script won't run!</dt>
<dd>Check your PerlMagick install. Configuring PerlMagick is beyond the scope of this document, but if you can't run the demo scripts supplied with the PerlMagick package then you shouldn't be here yet.</dd>
<dt>I get an error about 'No delegate for this image format'</dt>
<dd>Again, this is a PerlMagick issue - check your system path and the MAGICK_HOME variable.</dd>
<dt>Everything runs but the result doesn't look anything like yours!</dt>
  <dd>No idea. Send me your result and a brief description of your system configuration
    and I'll see if I can help. :)</dd>
</dl>
<hr>
<div align="center">
  <p><font size="2">The information and examples on this page may be freely distributed,
    modified, hacked, sold and<br>
    otherwise used without restriction</font><font size="2"> subject to the terms
    of the ImageMagick license agreement.<br>
    Feedback, comments and contributions to <u>imagemagick [at] dylanbeattie [dot] net</u></font></p>
  <p><font size="2">ImageMagick and PerlMagick are Copyright &copy; 2001 ImageMagick
    Studio<br>
    <a href="http://www.imagemagick.org/">http://www.imagemagick.org/</a></font></p>
</div>
<p>&nbsp; </p>
</body>
</html>
